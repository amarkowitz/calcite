# dummy.iq - Scratch space
#
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to you under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
!set outputformat mysql
!use scott

# select * from emp;

# !ok

# select e.ename, count(*) as c
# from emp as e, emp f
# where f.comm is not distinct from e.comm is TRUE
# group by e.ename;

# select e.ename, e.comm as ecomm, f.comm as fcomm
# from emp as e, emp f
# where f.comm is not distinct from e.comm;

# !ok

!if (false) {
WITH t0
AS (
SELECT EMPNO, ENAME, COMM, COMM IS NULL AS f8
FROM EMP
ORDER BY COMM, 4
),
t1
AS (
SELECT EMPNO, COMM
FROM EMP
),
t3
AS (
SELECT COMM, COMM IS NULL AS f8
FROM EMP
GROUP BY COMM, COMM IS NULL
),
t5
AS (
SELECT t3.COMM AS COMM0, t3.f8, COUNT(*) AS EXPR$0
FROM t1
INNER JOIN t3 ON t1.COMM IS NULL AND t3.f8 OR t1.COMM = t3.COMM
GROUP BY t3.COMM, t3.f8
ORDER BY t3.COMM, t3.f8
)
SELECT t0.ENAME, CASE WHEN t5.EXPR$0 IS NULL THEN 0 ELSE t5.EXPR$0 END AS C
FROM t0
LEFT JOIN t5 ON t0.COMM = t5.COMM0 OR t0.f8 AND t5.f8;

!ok
!}

!if (true) {
select e.ename,
  (select count(*) from emp as f
     where f.comm is not distinct from e.comm) as c
from emp as e;
!ok
!}
#    where f.comm IS NULL AND e.comm IS NULL) as c
# --     where f.comm is not distinct from e.comm) as c

# +--------+----+
# | ENAME  | C  |
# +--------+----+
# | ADAMS  | 10 |
# | ALLEN  |  1 |
# | BLAKE  | 10 |
# | CLARK  | 10 |
# | FORD   | 10 |
# | JAMES  | 10 |
# | JONES  | 10 |
# | KING   | 10 |
# | MARTIN |  1 |
# | MILLER | 10 |
# | SCOTT  | 10 |
# | SMITH  | 10 |
# | TURNER |  1 |
# | WARD   |  1 |
# +--------+----+
# (14 rows)
# !ok
# End dummy.iq
